# 交易資料合併程式修改歷程

## 版本 2.0.0 (2025-11-10)
### 主要更新
- 改進新倉時間查找邏輯
- 新增序號欄位功能
- 優化資料處理流程
- 加強錯誤處理機制

### 環境需求
1. Python 3.x
2. 相依套件：
   - pandas
   - numpy
   - tqdm

### 執行步驟
1. 環境準備：
   ```bash
   # 建立虛擬環境（選擇性）
   python -m venv venv
   source venv/bin/activate  # MacOS/Linux
   
   # 安裝相依套件
   pip install pandas numpy tqdm
   ```

2. 檔案準備：
   - 確保以下檔案位於同一目錄：
     - merge_trades.py（主程式）
     - 2021-2025 交易明细 工作表1.csv（交易明細檔）
     - 成交紀錄 2021-2025.csv（成交紀錄檔）

3. 執行程式：
   ```bash
   python merge_trades.py
   ```

4. 檢查結果：
   - 輸出檔案：合併交易紀錄.csv
   - 預期筆數：約 1,352 筆
   - 檢查欄位：
     - 成交時間
     - 新倉時間
     - 商品名稱
     - 口數
     - 新倉價
     - 平倉價
     - 平倉損益淨額

### 程式功能說明
1. 資料清洗階段：
   - 移除數值欄位中的千位數逗號和引號
   - 移除小數點後數字
   - 轉換時間格式
   - 新增 UUID 和序號欄位

2. 資料合併階段：
   - 第一階段：平倉交易配對
   - 第二階段：使用序號範圍查找新倉時間

3. 結果處理階段：
   - 篩選必要欄位
   - 確保數值型態為整數
   - 移除未配對記錄

### 注意事項
1. 資料準備：
   - 確保輸入檔案編碼正確
   - 備份原始資料
   - 檢查欄位名稱一致性

2. 執行過程：
   - 觀察進度條顯示
   - 檢查錯誤訊息
   - 確認處理筆數

3. 結果驗證：
   - 檢查輸出檔案完整性
   - 驗證資料合理性
   - 確認欄位格式正確

### 疑難排解
1. 檔案讀取錯誤：
   - 檢查檔案路徑
   - 確認檔案編碼
   - 驗證欄位名稱

2. 資料處理問題：
   - 檢查數值格式
   - 確認時間格式
   - 驗證配對邏輯

3. 輸出異常：
   - 檢查磁碟空間
   - 確認寫入權限
   - 驗證輸出格式

### 維護計畫
1. 定期更新：
   - 優化處理效能
   - 改進配對邏輯
   - 擴充錯誤處理

2. 功能擴充：
   - 新增資料驗證
   - 優化記憶體使用
   - 增加彈性設定