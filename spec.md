依照下面的規格重新產生程式碼
檔案合併邏輯（兩階段比對）
階段一：資料清洗與準備
載入檔案：

載入《交易明細》（主檔，df_main）。

載入《成交紀錄》（紀錄檔，df_records）。

資料清理與型態轉換：

清除數字格式：移除所有價格和金額欄位（例如：新倉價、平倉價、平倉損益淨額、成交價、手續費等）中的千位數逗號（,）和引號（"）。

清除小數點格式：移除所有價格和金額欄位（例如：新倉價、平倉價、平倉損益淨額、成交價、手續費等）中的小數點與小數點後的數字

時間轉換：將所有包含日期和時間的欄位（成交時間）轉換為標準的日期時間（datetime）格式，以確保精確比對。

數值轉換：將 口數 和 成交口數 欄位轉換為整數 (int64)。

比對型態準備：為了確保合併（比對）的準確性，新倉價 和 平倉價 欄位在比對階段保持為整數 (int64)。

在成交紀錄新增一個UUID欄位，值給16碼之亂數，確保資料的唯一性

在成交紀錄新增一個序號欄位，將資料根據成交時間排序後，編上序號

階段一：兩階段合併與新倉時間查找
目標： 在《交易明細》中新增 新倉時間 欄位。

步驟 1：比對平倉交易（Closing Leg）

此步驟是將《交易明細》中的平倉資訊，與《成交紀錄》中的平倉行為進行匹配。

主表（左）： 《交易明細》

副表（右）： 《成交紀錄》

比對鍵：

交易明細.成交時間 == 成交紀錄.成交時間

交易明細.平倉價 == 成交紀錄.成交價

交易明細.商品名稱 == 成交紀錄.商品名稱

結果： 合併後產生一個中間表 Merged1。

步驟 2：比對新倉交易（Opening Leg）

利用 Merged1 表中的新倉資訊，回頭尋找最早對應的開倉行為，並提取其成交時間。

主表（左）： Merged1

副表（右）：成交紀錄

比對鍵：

Merged1.新倉價 == 成交紀錄.成交價，這邊要用Merged1.序號去找前後5筆倉別為新倉的資料，所比對出來的成交時間才會是新倉時間

Merged1.商品名稱 == 成交紀錄.商品名稱

結果： 成功配對的行將帶入 成交紀錄.成交時間，我們將此欄位重新命名為 新倉時間。

階段二：結果輸出與最終型態調整
欄位整理：選擇最終所需的欄位，並確保它們是正確的順序：成交時間、新倉時間、商品名稱、口數、新倉價、平倉價、平倉損益淨額、UUID。

輸出：將最終的完整資料輸出為2021_2025交易與成交合併交易檔.CSV 檔案。

更新所有相關文件（如 version.md 和 spec.md）以反映最新的程式邏輯和功能說明。

如果檔案存在請更新，如果不存在請新增。

推送相關檔案至 https://github.com/warrenro/TRADEDATAMERGE.git

